select _jsonpath_exists(jsonb '{"a": 12}', '$.a.b');
 _jsonpath_exists 
------------------
 f
(1 row)

select _jsonpath_exists(jsonb '{"a": 12}', '$.b');
 _jsonpath_exists 
------------------
 f
(1 row)

select _jsonpath_exists(jsonb '{"a": {"a": 12}}', '$.a.a');
 _jsonpath_exists 
------------------
 t
(1 row)

select _jsonpath_exists(jsonb '{"a": {"a": 12}}', '$.*.a');
 _jsonpath_exists 
------------------
 t
(1 row)

select _jsonpath_exists(jsonb '{"b": {"a": 12}}', '$.*.a');
 _jsonpath_exists 
------------------
 t
(1 row)

select _jsonpath_exists(jsonb '{}', '$.*');
 _jsonpath_exists 
------------------
 f
(1 row)

select _jsonpath_exists(jsonb '{"a": 1}', '$.*');
 _jsonpath_exists 
------------------
 t
(1 row)

select _jsonpath_exists(jsonb '[]', '$.[*]');
 _jsonpath_exists 
------------------
 f
(1 row)

select _jsonpath_exists(jsonb '[1]', '$.[*]');
 _jsonpath_exists 
------------------
 t
(1 row)

select _jsonpath_exists(jsonb '[1]', '$.[1]');
 _jsonpath_exists 
------------------
 f
(1 row)

select _jsonpath_exists(jsonb '[1]', '$.[0]');
 _jsonpath_exists 
------------------
 t
(1 row)

select * from _jsonpath_query(jsonb '{"a": 12, "b": {"a": 13}}', '$.a');
 _jsonpath_query 
-----------------
 12
(1 row)

select * from _jsonpath_query(jsonb '{"a": 12, "b": {"a": 13}}', '$.b');
 _jsonpath_query 
-----------------
 {"a": 13}
(1 row)

select * from _jsonpath_query(jsonb '{"a": 12, "b": {"a": 13}}', '$.*');
 _jsonpath_query 
-----------------
 12
 {"a": 13}
(2 rows)

select * from _jsonpath_query(jsonb '{"a": 12, "b": {"a": 13}}', '$.*.a');
 _jsonpath_query 
-----------------
 13
(1 row)

select * from _jsonpath_query(jsonb '[12, {"a": 13}, {"b": 14}]', '$.[*].a');
 _jsonpath_query 
-----------------
 13
(1 row)

select * from _jsonpath_query(jsonb '[12, {"a": 13}, {"b": 14}]', '$.[*].*');
 _jsonpath_query 
-----------------
 13
 14
(2 rows)

select * from _jsonpath_query(jsonb '[12, {"a": 13}, {"b": 14}]', '$.[0].a');
 _jsonpath_query 
-----------------
(0 rows)

select * from _jsonpath_query(jsonb '[12, {"a": 13}, {"b": 14}]', '$.[1].a');
 _jsonpath_query 
-----------------
 13
(1 row)

select * from _jsonpath_query(jsonb '[12, {"a": 13}, {"b": 14}]', '$.[2].a');
 _jsonpath_query 
-----------------
(0 rows)

select * from _jsonpath_query(jsonb '[12, {"a": 13}, {"b": 14}]', '$.[0,1].a');
 _jsonpath_query 
-----------------
 13
(1 row)

select * from _jsonpath_query(jsonb '[12, {"a": 13}, {"b": 14}]', '$.[0 to 10].a');
 _jsonpath_query 
-----------------
 13
(1 row)

select * from _jsonpath_query(jsonb '{"a": 10}', '$');
 _jsonpath_query 
-----------------
 {"a": 10}
(1 row)

select * from _jsonpath_query(jsonb '{"a": 10}', '$ ? (a < $value)');
ERROR:  could not find 'value' passed variable
select * from _jsonpath_query(jsonb '{"a": 10}', '$ ? (a < $value)', '{"value" : 13}');
 _jsonpath_query 
-----------------
 {"a": 10}
(1 row)

select * from _jsonpath_query(jsonb '{"a": 10}', '$ ? (a < $value)', '{"value" : 8}');
 _jsonpath_query 
-----------------
(0 rows)

select * from _jsonpath_query(jsonb '{"a": 10}', '$.a ? (@ < $value)', '{"value" : 13}');
 _jsonpath_query 
-----------------
 10
(1 row)

select * from _jsonpath_query(jsonb '[10,11,12,13,14,15]', '$.[*] ? (@ < $value)', '{"value" : 13}');
 _jsonpath_query 
-----------------
 10
 11
 12
(3 rows)

select * from _jsonpath_query(jsonb '[10,11,12,13,14,15]', '$.[0,1] ? (@ < $value)', '{"value" : 13}');
 _jsonpath_query 
-----------------
 10
 11
(2 rows)

select * from _jsonpath_query(jsonb '[10,11,12,13,14,15]', '$.[0 to 2] ? (@ < $value)', '{"value" : 15}');
 _jsonpath_query 
-----------------
 10
 11
 12
(3 rows)

select * from _jsonpath_query(jsonb '[1,"1",2,"2",null]', '$.[*] ? (@ = "1")');
 _jsonpath_query 
-----------------
 "1"
(1 row)

select * from _jsonpath_query(jsonb '[1,"1",2,"2",null]', '$.[*] ? (@ = $value)', '{"value" : "1"}');
 _jsonpath_query 
-----------------
 "1"
(1 row)

